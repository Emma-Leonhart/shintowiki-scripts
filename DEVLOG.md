# Devlog — shintowiki bot operations

Running log of all significant bot operations and wiki changes. Most recent first.

---

## 2026-02-26

### Category page wikitext normalization
**Script:** `shinto_miraheze/normalize_category_pages.py` (new)
**Status:** Complete — **23,571 edited, 474 skipped, 0 errors**

Normalized all 24,045 non-redirect category pages to a clean three-section structure:

```
<!--templates-->
{{wikidata link|Q…}} etc.
<!--interwikis-->
[[ja:…]] [[en:…]] etc.
<!--categories-->
[[Category:…]]
```

Strips all free text, stray headings, Japanese prose, and any other content accumulated from previous automated passes. Added state file (`normalize_category_pages.state`) and JSONL log (`normalize_category_pages.log`) so the script is safe to re-run without re-processing completed pages.

### Deletion of Category:Jawiki_resolution_pages
**Script:** `shinto_miraheze/delete_jawiki_resolution_pages.py`
**Status:** Complete — **10,239 pages deleted**

Deleted all pages in `Category:Jawiki_resolution_pages`. These were stub pages created during earlier jawiki import passes that served no ongoing purpose. Deletion was performed in bulk via the bot account. Category is now empty.

### Imported Kuni no Miyatsuko pages
I imported all of the Kuni no Miyatsuko pages from jawiki, this is something that needed to be complete, and leaving it partway filled was causing issues. They still need to be translated and normalized and deduplicated.

---

## 2026-02-23

### History merge — `{{moved to}}` / `{{moved from}}` pairs
**Scripts:** `shinto_miraheze/merge_move_histories.py` (new), `shinto_miraheze/tag_move_link_quality.py` (new), `shinto_miraheze/tag_move_intersection.py` (new)
**Status:** Complete — **184 pairs merged, 0 errors**

Completed the full-history merge for all matched move pairs. For each pair (A = old name, B = new name):
1. B's content saved (with `{{moved from}}` stripped)
2. B deleted → revisions enter the deleted archive
3. A moved to B's title → B's title now holds A's revision history
4. B's content pasted onto the page at B's title
5. B's archived revisions undeleted → histories merge chronologically at B's title

Also introduced three maintenance categories populated by bot:
- `Category:moved from a redlink` — `{{moved from|X}}` where X doesn't exist
- `Category:moved to a redlink` — `{{moved to|X}}` where X doesn't exist
- `Category:moved from a non-redirect` — `{{moved from|X}}` where X exists but is not a redirect
- `Category:Move targets ∩ destinations` — pages with both templates (edge cases needing manual resolution)
- `Category:move templates that do not link to each other` — pages whose templates form a contradictory/mismatched pair (7 pages; needs manual review)

History fully preserved for all 184 merged pages. Marginal exceptions: the 7 pages in the error category, plus the pre-existing ∩ cases that were cleared manually.

---

## 2026-02-20

### ja: interwiki category merge and QID linking
**Script:** `shinto_miraheze/merge_by_ja_interwiki.py` (new)
**Status:** Complete — **22 linked, 40 merged, 0 errors**
Scans all 834 categories in [Category:Categories missing Wikidata with Japanese interwikis](https://shinto.miraheze.org/wiki/Category:Categories_missing_Wikidata_with_Japanese_interwikis). Builds a map of jawiki target → shintowiki categories, then:

- **Single match** — queries jawiki API for the QID, creates a `Q{QID}` redirect page and adds `{{wikidata link|Q...}}` to the category (same flow as `resolve_missing_wikidata_categories.py`)
- **One CJK + one Latin sharing same jawiki target** — merges: recategorizes all members from the CJK category into the Latin one, redirects the CJK category, then adds the wikidata link to the Latin category
- **Two or more Latin sharing same jawiki target** — tags all with `[[Category:jawiki categories with multiple enwiki]]` for manual review

Results: 754 singles (22 linked, 732 skipped — no jawiki QID), 40 shared-target groups (all clean CJK+Latin pairs, all merged). 0 tagged-multi cases, 0 errors.

---

## 2026-02-19

### Tagging categories missing Wikidata but with Japanese interwikis
**Script:** `shinto_miraheze/tag_missing_wikidata_with_ja_interwiki.py` (new)
**Status:** Complete — **834 categories tagged**, 4209 skipped (no ja: interwiki), 0 errors
Scans all members of Category:Categories_missing_wikidata for `[[ja:...]]` interwiki links in their wikitext. Tags any that have one with `[[Category:Categories missing Wikidata with Japanese interwikis]]`. This intermediate categorization step makes it easy to later batch-process that subset: the ja: link provides a direct path to the jawiki category, from which the QID can be retrieved.

### Missing Wikidata link resolution
**Script:** `shinto_miraheze/resolve_missing_wikidata_categories.py` (new)
**Status:** Complete
For every category in [Category:Categories_missing_wikidata](https://shinto.miraheze.org/wiki/Category:Categories_missing_wikidata): queries the English or Japanese Wikipedia API (enwiki for Latin names, jawiki for CJK names, with fallback to the other) for `Category:{name}` and retrieves the `wikibase_item` QID from pageprops. If found:

- **Q page doesn't exist on shintowiki** → create `Q{QID}` as `#REDIRECT [[Category:Name]]` and add `{{wikidata link|Q...}}` to the category page
- **Q page redirects to this same category** → just add `{{wikidata link|Q...}}` to the category page
- **Q page redirects to a different English category** → merge (recategorize members + redirect this category), same logic as `merge_japanese_named_categories.py`
- **Q page is a disambiguation list** → skip

Result: **2425 actionable** out of 5054 checked — 2410 Q pages created + wikidata links added, 4 wikidata links added to existing Q-linked categories, 11 merges into English equivalents. 2629 skipped (no Wikipedia equivalent found). 0 errors.

### Japanese-named category merges
**Script:** `shinto_miraheze/merge_japanese_named_categories.py` (new)
**Status:** Complete
For every category in [Category:Japanese_language_category_names](https://shinto.miraheze.org/wiki/Category:Japanese_language_category_names): finds the `{{wikidata link|Q...}}` on the category page, looks up the Q{QID} mainspace page, and if that Q page is a simple `#REDIRECT [[Category:EnglishName]]` to a non-CJK category, recategorizes all members from the Japanese-named category to the English one and redirects the Japanese category page.

Skips if: no wikidata link, Q page doesn't exist, Q page redirects back to a CJK name (no English equivalent on this wiki yet), or Q page is a disambiguation list (handled separately by `resolve_duplicated_qid_categories.py`).

Result: **1274 categories merged** out of 2417 checked (ran in two passes — first pass crashed at 84 on edit conflict with concurrent crud script; second pass completed remaining 1190 cleanly with 0 errors).

### [[sn:...]] interwiki link removal
**Script:** `shinto_miraheze/remove_sn_interwikis.py` (new)
**Status:** Complete
Strips all `[[sn:...]]` links from every page on the wiki. These were accidentally used as a note-storage mechanism during earlier bot passes — e.g. `[[sn:This category was created from JA→Wikidata links on Fuse Shrine (Sanuki, Kagawa)]]`. The `sn` language code produces meaningless interwiki links and serves no purpose. Uses `insource:"[[sn:"` full-text search to find affected pages (the `list=alllanglinks` API module is not available on Miraheze), then strips the pattern from each.

Result: 1 page affected ([Help:Searching](https://shinto.miraheze.org/wiki/Help:Searching)), 3 links removed. The minimal footprint confirms these were all added during a single earlier pass.

### Crud category cleanup
**Script:** `shinto_miraheze/remove_crud_categories.py` (new)
**Status:** Running (two instances — original + second pass for subcategories added during runtime)
Fetches all subcategories of [Category:Crud_categories](https://shinto.miraheze.org/wiki/Category:Crud_categories) and strips those category tags from every member page. Goal is to leave all the crud subcategories empty. These were leftover maintenance/tracking categories accumulated from various automated passes that serve no ongoing purpose.

21 subcategories identified in the original run. The script caches the subcategory list at start and fetches members live per subcategory. A second instance was started to catch any new subcategories added to Category:Crud_categories during the first run's execution. By far the slowest script this session — the first subcategory alone (Category:11) had 1568 members. The individual-edit-per-page approach is suboptimal for bulk cleanup but is intentional and generative; the slow pace is not considered an error.

### Duplicate QID category resolution
**Script:** `shinto_miraheze/resolve_duplicated_qid_categories.py` (new)
**Status:** Partially complete — 146/221 processed; needs re-run for remainder
Processes all Q{QID} pages in [Category:Duplicated qid category redirects](https://shinto.miraheze.org/wiki/Category:Duplicated_qid_category_redirects). These are QID redirect pages where two categories — one with a Japanese name and one with an English name — share the same Wikidata QID, meaning they are the same category under two names.

Logic:
- **CJK name + Latin name pair** (e.g. `Category:上野国` + `Category:Kōzuke Province`): recategorizes all members from the CJK category to the Latin/English one, redirects the CJK category page to the Latin one, and converts the Q page to a simple `#REDIRECT [[Category:LatinName]]`.
- **Both Latin names**: cannot auto-resolve — tags the Q page with `[[Category:Erroneous qid category links]]` for manual review.

Run crashed at Q8976949 (Category:一宮 → Category:Ichinomiya, 36 members) with an edit conflict — concurrent editing with the crud cleanup script. 146 Q pages were fully resolved before the crash. Re-run will skip already-resolved pages since they no longer appear in the category.

### Wanted categories created
**Script:** `shinto_miraheze/create_wanted_categories.py` (new, ran this session)
**Status:** Complete
Created 153 category pages that had members but no page (showed up in Special:WantedCategories). Each got `[[Category:categories made during git consolidation]]`. [Category:Duplicated qid category redirects](https://shinto.miraheze.org/wiki/Category:Duplicated_qid_category_redirects) got special documentation explaining the Q-page format and how to resolve entries. Parent category [Category:categories made during git consolidation](https://shinto.miraheze.org/wiki/Category:Categories_made_during_git_consolidation) also created.

### Repository consolidation
- Moved all root-level scripts into `shinto_miraheze/`
- Deleted `aelaki_miraheze/` (project abandoned)
- Deleted `archive/` directory (544 files; all preserved in git history)
- Added `TODO.md`, `HISTORY.md`, `DEVLOG.md` to repo
- Cleaned up README (removed speech-to-text dump, replaced with proper docs)

---

## 2026-02-19 (earlier — previous Claude session, interrupted by system crash)

### DEFAULTSORT removal from shikinaisha pages
**Script:** `shinto_miraheze/remove_defaultsort_digits.py`
**Status:** Complete
Removed `{{DEFAULTSORT:…}}` from all pages in `Category:Wikidata generated shikinaisha pages`. These were auto-generated by an earlier script and served no purpose.

### Category Wikidata link addition
**Script:** `shinto_miraheze/resolve_category_wikidata_from_interwiki.py`
**Status:** Complete (full pass Feb 2026)
Added `{{wikidata link|Q…}}` to all category pages that had interwiki links but no Wikidata connection. Used interwiki links to look up QIDs.

### QID redirect creation for categories
**Script:** `shinto_miraheze/create_category_qid_redirects.py`
**Status:** Complete (ran concurrently with above — possible race condition artifacts, scope unknown)
Created `Q{QID}` mainspace redirect pages for all categories with `{{wikidata link}}`. Where two categories shared a QID, created a numbered disambiguation list and tagged with `[[Category:Duplicated qid category redirects]]`.

### Duplicate category link fix
**Script:** `shinto_miraheze/fix_dup_cat_links.py`
**Status:** Complete (one-off)
Fixed `[[Category:X]]` → `[[:Category:X]]` in the dup-disambiguation Q pages. An earlier run of the QID redirect script had accidentally created category tags instead of category links in those pages.

---

## 2025 — Shikinaisha project

### Mass shikinaisha page generation
**Script:** `shinto_miraheze/generate_shikinaisha_pages_v24_from_t.py` (and earlier versions)
Generated wiki pages for shikinaisha (式内社 — shrines listed in the Engishiki) from Wikidata. Earlier versions used ChatGPT translation; later versions used Claude. Pages were generated with Japanese Wikipedia content imported and translated.

### Shikinaisha data upload to Wikidata
Multiple scripts (now in git history) ran in June–July 2025 to:
- Import shrine ranks from Japanese Wikipedia categorization into Wikidata
- Import shikinaisha entries from Japanese Wikipedia list pages (via Excel intermediary)
- Import from Kokugakuin University shrine database (caused many duplicate entries — significant WikiProject Shinto backlash, but data was not removed)

### ILL destination fixing
**Script:** `shinto_miraheze/fix_ill_destinations.py`
Multiple passes to fix `{{ill}}` template `1=` destinations using the QID redirect chain. See `SHINTOWIKI_STRUCTURE.md` for the resolution priority order.

---

## 2024–2025 — Category and interwiki passes

Various scripts (archived in git history) ran to:
- Add interwiki links to categories and main namespace pages from Wikidata
- Add Wikidata labels in multiple languages (Dutch, French, German, Indonesian, Turkish, etc.)
- Sync category interwiki links across Wikipedia editions (ja, de, zh, en)
- Add P31 (instance of) categories in bulk
- Generate and update shrine descriptions

---

## 2024 — Wiki restoration

Wiki was suspended by Miraheze and then reinstated. Restored from XML export obtained via Archive.org. Only most recent revision of each page was imported (not full history). Full history import is pending on Miraheze's side.

`{{moved to}}` and `{{moved from}}` templates introduced to preserve attribution across the two waves of page moves that occurred around this time.

---

## 2023–2024 — Wiki founding and initial imports

Wiki founded at shinto.miraheze.org. Initial pages imported from:
- English Wikipedia drafts (user was permanently blocked from enwiki December 2023)
- Simple English Wikipedia user pages (used as temporary holding space)
- Everybody Wiki

Early content workflow: ChatGPT translation of Japanese Wikipedia pages, with `{{ill}}` templates added for all links. All links on the wiki use `{{ill}}` — no bare wikilinks to other wikis.

Repository initially created for Wikidata edits. First major project: documenting Beppu shrines and Association of Shrines special-designation shrines.
