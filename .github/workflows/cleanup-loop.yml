name: shinto-cleanup-loop

on:
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    env:
      WIKI_USERNAME: ${{ secrets.WIKI_USERNAME }}
      WIKI_PASSWORD: ${{ secrets.WIKI_PASSWORD }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: pip install mwclient requests

      - name: Validate required secrets
        run: |
          if [ -z "${WIKI_USERNAME}" ] || [ -z "${WIKI_PASSWORD}" ]; then
            echo "WIKI_USERNAME and WIKI_PASSWORD secrets are required."
            exit 1
          fi

      - name: Run cleanup loop
        run: |
          chmod +x shinto_miraheze/cleanup_loop.sh
          shinto_miraheze/cleanup_loop.sh
